<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML Level 2.0 2//EN">
<!-- Generated by Text2HTMLGIF (afi, ejz)-->
<HTML>
<HEAD>
<META NAME="Author" CONTENT="Andre Fischer">
<TITLE>Compiler, Builder and Analyzer User Guide</TITLE>
</HEAD>
<BODY><H1><CENTER>Compiler, Builder and Analyzer User Guide</CENTER></H1><HR>
<CENTER><B>[ Text | <A HREF="Compiler.Contents.html">Contents</A> | <A HREF="Compiler.Index.html">Index</A> | <A HREF="Big.Index.html">Master index</A>]</B></CENTER><BR>
<BR>
<H1>
<A NAME="0"></A>Tutorial objective</H1>
Learn to use the Oberon Compiler and its front-end called Builder.
<P>Estimated time: 30 minutes.
<P><HR>
<H1>
<A NAME="Intro"></A>Introduction</H1>

<BR>The input to the compiler are texts. Such texts are conveniently created in text viewers using the <A HREF="Oberon3TUI.html#Editor">system editor</A>. The following naming convention (widely used) is recommended for files storing source programs:
<BR>
<UL><I>
<BR>name</I>.Mod where <I>name</I> usually corresponds to the module's name (MODULE <I>name</I>;).
<BR></UL>
<BR>For an introduction to the Oberon programming language refer to the <A HREF="Main.html#Literature">Literature on Oberon</A>. But the only way to learn a new programming language is by reading and writing programs in it.
<H2>
<A NAME="1"></A>A first example</H2>
The very first program is the same for all programming languages! In Oberon, the program to write <B>hello, world</B> is
<P><IMG ALT="Cool Oberon Object " SRC="images/Compiler1.gif" OBJECT="CompilerObjs.0">
<BR>To learn how to use the compiler go through the following steps:
<BR>
<OL>
<BR>
<LI><A HREF="Mouse.html#Marker">mark</A> the text above and execute <CALL CMD="Compiler.Compile *"><FONT COLOR=FF0000>Compiler.Compile *</FONT></CALL> ,
<LI>observe the message in the Oberon log:
<BR>    compiling Hello 33
<BR>The number following the module name is the size of the object file now stored in the current directory.
<LI>execute <CALL CMD="Hello.World"><FONT COLOR=FF0000>Hello.World</FONT></CALL> and watch the output hello, world in the log.</OL>
<BR><HR>
<H1>
<A NAME="Compiler"></A>Using the compiler</H1>

<BR>The Compiler is an important component of the Oberon system. Except for parts of the inner core, Oberon System 3 is implemented in the original Oberon language. The compiler supplied is an Oberon-2 compiler. Any Oberon-2 compiler is compatible in principle with System 3 and System 3 programs can be written and compiled with Oberon-2.The compiler can generate two types of object files: classical 
<A NAME="2"></A>native object files containing <I>target machine code</I> or by default 
<A NAME="3"></A>slim binaries. Slim binaries are a new form of object files that contain no object code at all, but a <I>portable description of module's</I> content that makes these files completely independent of the eventual target machine (platform independent). Object code generation is carried out on-the-fly by the module loader (depending on the underlying hardware) and takes no longer than loading traditional object files.
<P>The module Compiler exports only two commands which are documented in a a couple of variations in the 
<A NAME="4"></A>Compiler.Tool and are described below.
<P>
<H2>
<A NAME="Compile"></A>Compiling source text(s) - Compiler.Compile</H2>
<B>Compiler.Compile @[\options]</B> compiles the source text starting at the most recent text selection.<I>
<P></I><B>Compiler.Compile *[\options]</B> compiles the source text of the marked viewer.
<P>These two first variants of the command allow compiling a module directly from the text editor: there is no need to store the text first.<I>
<P></I><B>Compiler.Compile {[\dst=pathName] [\options] {fileName[\options]}}~ | ^</B> compiles the text of the files named in the parameter list. <B>pathName</B> directs the compiler to store new object files in the specified sub-directory.
<P>The <B>options</B> are:
<BR>
<UL><B>
<BR>s</B> - Enable generation of new <B>s</B>ymbol file<B>
<BR>e</B> - Enable generation of <B>e</B>xtended symbol file<B>
<BR>u</B> - Suppress compilation if the object file is <B>u</B>p-to-date<B>
<BR>w</B> - Enable generation of <B>w</B>arning messages
<BR></UL>
<BR>When compiling a sequence of modules, the order of the file names must comply with the module import hierarchy: from the bottom to the top; that is, clients of a module must be compiled after the module itself. You can avoid this by using the <A HREF="#Builder">Builder</A> facilities instead. Note that each file name may be followed by options.
<P>The following options are valid only when the compiler must generate native object files. These files are <B>not</B> portable accross platform boundaries. Therefore, these options should be used only when writing an extension that uses the low-level module SYSTEM or the built-in SIZE function. Example: Win.Audio.Mod
<BR>
<UL><B>
<BR>N</B> - E<B>n</B>able generation of native object file<B>
<BR>a</B> - Suppress code generation for <B>A</B>SSERT function<B>
<BR>p</B> - Suppress initialization of local <B>p</B>ointers to NIL<B>
<BR>x</B> - Disable Inde<B>x</B> Checks<B>
<BR>n</B> - Disable <B>N</B>IL Checks<B>
<BR>t</B> - Disable <B>T</B>ype Checks<B>
<BR>v</B> - Enable O<B>v</B>erflow Checks<B>
<BR>c</B> - Disable Range <B>C</B>hecks<B>
<BR>r</B> - Suppress generation of <B>r</B>ef-info<B>
<BR>d</B> - Generate MacsBug <B>d</B>ebugger information (MacOberon)<B>
<BR>f</B> - <B>f</B>ind text position corresponding to the selected program counter value<B>
<BR>g</B> - Suppress <B>g</B>arbage collection after this compilation
<BR></UL>
<BR>If garbage collection is suppressed, compilation runs faster but might not be completed if too much memory or too many files are used (will trap).
<P>
<H2>
<A NAME="5"></A>Directing the object files - Compiler.SetDestPath</H2>
<B>Compiler.SetDestPath pathName</B> directs the compiler to store new object files in the specified sub-directory.
<P>
<H2>
<A NAME="6"></A>Directing the loading of slim binaries</H2>
The following commands influence the loading of slim binaries:
<P><B>OMI.AssertsOn / OMI.AssertsOff</B> enables/disables code generation for ASSERTS function.
<P><B>OMI.ChecksOn / OMI.ChecksOff</B> enables/disables index checks.
<P><B>OMI.RefsOn / OMI.RefsOff</B> enables/disables generation of detailed reference information.
<P>These commands can be conveniently placed in the Configuration. Text file.
<P>
<H2>
<A NAME="UnloadMod"></A>Unloading a module prior to execution</H2>
If you make changes to a module and re-compile it after it had been used (i.e. loaded), you must unload it with the <A HREF="Oberon3TUI.html#Free">System.Free</A> command or with the mouse:
<P>when the mouse focus is positioned on a command name M.P and the middle mouse key is pressed, <IMG ALT="Cool Oberon Object " SRC="images/Compiler2.gif" OBJECT="CompilerObjs.2"> a left mouse key interclick unloads the module M containing the command and loads a new copy of it, before the command is executed.
<P><B>Programmer hint and warning:</B> This is very useful while developing and debugging Oberon procedures. It is a handy short cut for executing a System.Free command, but module M is unloaded only when it has no client. Therefore, remember that <A HREF="Oberon3TUI.html#Free">System.Free</A> and also <A HREF="#Free">Builder.Free</A> offer additional possibilities.
<P>Do not be surprised if your corrections have had no impact: the <I>old</I> module version is still in control! Too often will you forget to force the system to use the updated version.
<P>The next example should help to concretise what has been said before:
<BR>
<UL>
<PRE>
    MODULE Client;
        IMPORT Hello;

        PROCEDURE MyAction*;
        BEGIN Hello.World
        END MyAction;

    END Client.</PRE>
<BR></UL>
<OL>
<BR>
<LI>select the beginning of the module text
<LI>execute Compiler.Compile @
<LI>execute Client.MyAction
<LI>execute System.Free Hello ~
<LI>observe and explain the log message: Hello unloading failed</OL>
<BR>
<H2>
<A NAME="7"></A>Compiling a modified example</H2>
<IMG ALT="Cool Oberon Object " SRC="images/Compiler3.gif" OBJECT="CompilerObjs.6">
<BR>
<OL>
<BR>
<LI>modify the text "hello, world" (e.g. "Hello Oberon")
<LI>execute Compiler.Compile * (i.e. re-compile the program)
<LI>execute Hello.World and see how the same "hello, world" appears in the Oberon log.
<LI>force the system to unload the module and to execute the new version of the command <CALL CMD="Hello.World"><FONT COLOR=FF0000>Hello.World</FONT></CALL> with a middle + left mouse keys interclick.</OL>
<BR>
<H2>
<A NAME="8"></A>Locating and correcting a syntax error</H2>
<IMG ALT="Cool Oberon Object " SRC="images/Compiler4.gif" OBJECT="CompilerObjs.8">
<BR>
<OL>
<BR>
<LI>delete a semicolon in the program
<LI>move the caret to <I>another</I> position in the text
<LI>execute Compiler.Compile *
<UL>    The Oberon log now displays:        compiling Hello        pos nn err 39</UL>
<LI>select the line with the error message, and click on the [Locate] button in the menu bar of the Oberon log. This sets the caret at the position of the missing semicolon. The error can easily be corrected.</OL>
<BR>
<H2>
<A NAME="debug"></A>Debugging compiler detected syntax errors</H2>
Compiler detected errors are reported in the Oberon log by messages of the form:
<BR>     pos &lt;error position> err &lt;error number>
<P>meaning: Error &lt;error number> occurred at position &lt;error position> in the source text.
<P>The following procedure places the caret at an error position in the source text:
<BR>
<OL>
<BR>
<LI>make sure that the source text appears in a viewer
<LI>mark the viewer
<LI>select an error message line in the Oberon log
<LI>click on the [Locate] button in the menu bar or
<LI>execute the command TextDocs.Locate or
<LI>execute the command <A HREF="Oberon3TUI.html#EditLoc">Edit.Locate</A>.</OL>
<BR>The Oberon compiler error numbers with a short explanation for each of them are listed in the document <CALL CMD="Desktops.OpenDoc OberonErrors.Text"><FONT COLOR=FF0000>OberonErrors.Text</FONT></CALL> included in the Oberon distribution.
<P>You need to recompile a module until no error is reported. Warnings may however be issued, but they are not considered as errors and thus an object file is created. 
<P>
<H2>
<A NAME="TrapViewer"></A>The trap viewer</H2>
If a command execution fails, the run-time error leads to an abnormal program termination and an error report is displayed in a text viewer 'System.Trap'. The error which caused the trap is identified with a trap code, the contents of certain system registers is displayed and the stack of procedure activations is displayed starting with the procedure on top of the invocation stack. All scalar variables and strings together with their values are also listed.
<BR>
<PRE>
    MODULE Trap;
        VAR arr: ARRAY 3 OF INTEGER;

        PROCEDURE count(n: INTEGER);
        BEGIN arr[n] := n; count(n+1)
        END count;

        PROCEDURE ForceIt*;
        BEGIN count(0)
        END ForceIt;

    END Trap.</PRE>
<BR>
<OL>
<BR>
<LI>select the beginning of the module text
<LI>execute Compiler.Compile @
<LI>execute Trap.ForceIt and study the content of the viewer.</OL>
<BR>The trap codes are explained at the end of <CALL CMD="Desktops.OpenDoc OberonErrors.Text"><FONT COLOR=FF0000>OberonErrors.Text</FONT></CALL>.
<P>In order to find the failing statement simply display the source program and mark its viewer. Then select the line in the trap viewer containing the procedure name of interest and recompile the program using the "\d" or "\f" option.
<P><HR>
<H1>
<A NAME="Builder"></A>Using the builder</H1>

<BR>The Builder provides a convenient front-end to the Oberon compiler described above. It makes sure that module texts are presented to the compiler in a correct order, whatever the order of the file names in the parameter list. It is however not a true make tool: all the modules to compile must be specified. Note that the parameter list must contain file names: these may differ from the module names, but that is a matter of convention. The Builder module commands are documented in the Builder.Tool.
<H2>
<A NAME="9"></A>Compiling source text - Builder.Compile</H2>
<B>Builder.Compile [\options] *</B> compiles the source text of the marked viewer. All <I>error markers</I> inserted in the text are removed.
<P><B>Builder.Compile [\options] ({fileName}~ | ^ | *)</B> compiles the text of the files named in the parameter list, automatically determining a correct compilation order of the modules. All the modules to compile must be specified, i.e. it is not a true make tool. The options are those of the <A HREF="#Compile">Compiler.Compile</A> command.
<P>
<H2>
<A NAME="marker"></A>Efficient handling of compiler detected errors</H2>

<A NAME="10"></A><B>Builder.MarkErrors [^]</B> when the selection contains an error message written by the compiler in the Oberon log, this command inserts an error marker in the marked text for that message and for all of the following messages. An <I>error marker</I> is a special (builder) gadget displaying the number of the error code discovered at that location in the program text. The following error message
<BR>
<PRE>     pos 111 err 4
</PRE>
<BR>would cause <IMG ALT="Cool Oberon Object " SRC="images/Compiler5.gif" OBJECT="CompilerObjs.10"> to be placed at the position 111.
<P>
<A NAME="11"></A><B>Builder.NextError</B> advances the caret to the next error marker. When the end of text is reached, searching wraps around to the beginning.
<P>
<A NAME="12"></A><B>Builder.ClearErrors</B> removes all error markers in the marked text. Automatically performed by a Builder.Compile * command.
<P>
<H2>
<A NAME="Free"></A>Unloading modules - Builder.Free</H2>
<B>Builder.Free {fileName}~ | ^</B> unloads every module named in the parameter list in a correct order. Since file names must appear in the parameter list, this command can only free modules for which the source text is available. To unload other modules use <A HREF="Oberon3TUI.html#Free">System.Free</A>.
<P>
<H2>
<A NAME="13"></A>Inserting module icons - Builder.InsertHierarchy</H2>
<B>Builder.InsertHierarchy {fileName}~ | ^</B> inserts an icon for each module named in the parameter list at the caret. The icons are inserted in a correct order of compilation. Each icon is captioned with a file name and its <I>Cmd</I> attribute value is "Desktops.OpenDoc '#Caption '".
<A NAME="14"></A> An example of such icons is found in the <CALL CMD="Desktops.OpenDoc Compiler.Panel"><FONT COLOR=FF0000>Compiler.Panel</FONT></CALL>.
<P><HR>
<H1>
<A NAME="Analyzer"></A>Using the analyzer</H1>

<BR>The Analyzer provides a convenient complement to the Oberon compiler for locating additional potential errors in a syntactically correct program text. Compiler errors are reported first. No object code is generated. The analyzer locates:
<BR>
<UL>
<BR>
<LI>non-exported items (variables / constants / types / fields) that are declared but never used, used before being initialized(*), never initialized and initialized but never used.
<LI>non-exported [type-bound] procedures that are never called.
<LI>imported modules that are never used.</UL>(*) For variables declared in a different scope, no warning is produced (see option \u, however).
<P>The Analyzer module command is documented in the 
<A NAME="15"></A>Analyzer.Tool.
<P>
<H2>
<A NAME="16"></A>Analyzing source text - Analyzer.Analyze</H2>
<B>Analyzer.Analyze @[\options]</B> analyzes the source text starting at the most recent text selection.
<P><B>Analyzer.Analyze *[\options]</B> analyzes the source text of the marked viewer.
<P>These two first variants of the command allow analyzing a module directly from the text editor: there is no need to store the text first.<B>
<P>Analyzer.Analyze {fileName[\options]}~ | ^</B> analyzes the source text of the files named in the parameter list.
<P>Analyzer.Analyze warns for possible errors in the Oberon log by message of the form:
<BR>pos &lt;error position> warning &lt;warning number>
<P>Refer to <A HREF="#debug">Debugging compiler detected syntax error</A>.
<P>Analyzer.Analyze also reports the number of statements (assignment, if, while, procedure call, etc.) in the module. This is convenient for determining the complexity of a program, instead of the number of lines.
<P>Error markers can be inserted in the source text as explained in <A HREF="#marker">Efficient handling of compiler detected errors</A>.
<P>Additional information can be obtained by specifying one or several <B>options</B>:
<BR>
<UL><B>
<BR>i</B> (<B>i</B>ntermediate) - locates
<BR>- items that are already declared in an outer scope.
<BR>- the use of or the assignment to intermediate items, e.g. local variables/parameters declared in an outer scope.<B>
<BR>s</B> (evaluation <B>s</B>equence) - locates calls of procedures with more than one parameter, where function calls occur in the parameter list. The evaluation sequence of parameters may affect the side effects of these functions.<B>
<BR>t</B> (<B>t</B>ype-bound) - locates
<BR>- the redefinition of type bound procedures.
<BR>- the new definition of type bound procedures in an extended type.<B>
<BR>u</B> (<B>u</B>sed) - locates variables declared in a different scope which are used before set.<B>
<BR>v</B> (<B>V</B>AR parameter) - locates variables that are used as VAR parameters and are therefore not ensured to be initialized.<B>
<BR>x</B> (e<B>x</B>ported) - locates exported items that are declared but not used by the module itself, used before being initialized, never initialized or initialized but never used.
<BR></UL>
<BR>
<HR>
<BR>Revised, afi 10 Dec 1996<BR>Installed on 14 Feb 1997<HR></BODY>
</HTML>

